---
title: "ROV - Fish and Invert Analysis"
author: "Shelby Ziegler"
date: "7/12/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---
This R markdown file combined the ROV transect data for both fish and invertebrates into one dataset for analysis. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(plotrix)
library(scales)

theme_set(theme_classic(base_size=16))
alpha=0.5
```

Read in the fish and invertebrate data sets. 
```{r}
fish<-read.csv("ROVFish_Transects_2005-2019SLZ.csv")

invert<-read.csv("Invert_Transects_2005-2019_SLZ2021-07-12.csv")

```

Filter data so that only types with SMCA and SMR are included. Bin depths and filter out data outside of the 30-60m and 60-130m depth zones. Summarize data to calculate total density so all species based on MPA, depth zone, habitat type and species for both fish and invertebreate datasets. 

```{r}
summary(fish)

#Filter out any MPA type that is not SMCA or SMR
fish1<-fish%>%
  group_by(Survey_Year, Region, MPA_Group, Type, Designation, Dive, Line, Habitat_Type, Avg_Depth..m., CommonName, SpeciesName)%>%
  filter(Type=="SMCA" | Type=="SMR")

#Bin depth data  
b<-c(-Inf, 30, 60, 130, Inf)
names <- c("0-30 m", "30-60 m", "60-130 m", "130+ m")
fish1$depth <- cut(fish1$Avg_Depth..m., breaks = b, labels = names)

#Filter depths to only hace 30-60m and 60-130m and sum the total density for each line for each species.
fish1<-fish1%>%
  filter(depth=="30-60 m" | depth=="60-130 m")%>%
  group_by(Survey_Year, Region, MPA_Group, Type, Designation, Dive, Line, depth, Habitat_Type, CommonName, SpeciesName)%>%
  summarize(totalden=sum(Density..m2.))

fish1$taxa<-"fish"
#Repeat for invertebrate data
summary(invert)

#Filter out any MPA type that is not SMCA or SMR
invert1<-invert%>%
  group_by(Survey_Year, Region, MPA_Group, Type, Designation, Dive, Line, Habitat_Type, Avg_Depth..m., CommonName, SpeciesName)%>%
  filter(Type=="SMCA" | Type=="SMR")

#Bin depth data  
invert1$depth <- cut(invert1$Avg_Depth..m., breaks = b, labels = names)

#Filter depths to only hace 30-60m and 60-130m and sum the total density for each line for each species.
invert1<-invert1%>%
  filter(depth=="30-60 m" | depth=="60-130 m")%>%
  group_by(Survey_Year, Region, MPA_Group, Type, Designation, Dive, Line, depth, Habitat_Type, CommonName, SpeciesName)%>%
  summarize(totalden=sum(Density..m2.))

invert1$taxa<-"invertebrate"
#Merge the fish and invertebrate datasets into one by using rbind to have columns match
rovall<-rbind(fish1, invert1)

#Write csv file for combined datasets
#write.csv(rovall, "ROV-fishandinvertCombined_2005-2019.csv")
```

Read in combined data set (can skip code above) and examine total densities for fish and invertebrates. 

```{r cars}
rovall<-read.csv("ROV-fishandinvertCombined_2005-2019.csv")

#Sum the density of all fishes for a single Line ID (Dive and Line) to calculate total density
rov<-rovall%>%
  group_by(Survey_Year, Region, MPA_Group, Type, Designation, Dive, Line, depth, Habitat_Type, taxa)%>%
  filter(CommonName!="YOY")%>%
  summarize(Total.Density=sum(totalden))

#Calculate the mean density for fish and invertebrates at each MPA per Year with depth and habitat type. 
rov1<-rov%>%
   group_by(Survey_Year, Region, MPA_Group, Type, Designation, depth, Habitat_Type, taxa)%>%
  summarize(MeanDensity=mean(Total.Density),
                       SE=std.error(Total.Density), 
                       lower = mean(Total.Density) - qt(1- alpha/2, (n() - 1))*sd(Total.Density)/sqrt(n()),
                       upper = mean(Total.Density) + qt(1- alpha/2, (n() - 1))*sd(Total.Density)/sqrt(n()))

#Fill NAs with 0s 
rov1[is.na(rov1)] <- 0

#Filter out unusable habitat codes
rov1<-rov1%>%
  filter(Habitat_Type!="Unusable")
```

Start with simple plots for each MPA by depth and habitat type across years

```{r}
#Filter by depth 
rov30<-rov1%>%
  filter(depth=="30-60 m")

rov60<-rov1%>%
  filter(depth=="60-130 m")

den_fun1<-function(parameter, dt){
  

#plot total fish density through time for MPA and Reference Sites
p<-(ggplot(dt[dt$MPA_Group==parameter,], aes(x=Survey_Year, y=MeanDensity, fill=Designation, shape=taxa)) + 
  #geom_histogram(color="black", position="dodge")+
  geom_point(size=5, alpha=0.5)+
    geom_line(aes(color=Designation, linetype=taxa))+
    scale_shape_manual(values=c(21,22))+
  scale_fill_manual(values=c('#b2182b','#2166ac'))+
  #geom_smooth(method='lm', se=FALSE, aes(color=Site))+
  scale_color_manual(values=c('#b2182b','#2166ac'))+
  ylab('Total Density (#/m2)')+
  xlab("Year")+
  scale_x_continuous(breaks= c(2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013,  2014, 2015, 2016,  2017, 2018, 2019))+
  geom_hline(yintercept = 0, linetype="dashed")+
  geom_errorbar(aes(ymax=upper, ymin=lower), width=0)+
  #scale_y_continuous(breaks= pretty_breaks())+
    facet_grid(Habitat_Type~Type)+
  # xlim(c(2006,2021))+
  ggtitle(paste0(parameter))+
  theme(plot.title = element_text(size = 16, face = "bold")))+
  theme(panel.border = element_rect(colour = "black", fill=NA, size=1))+
  guides(fill=guide_legend(override.aes=list(shape=21)))

return(p)
}

#Save as list and plot figures
denplot_list1 <-lapply(unique(rov30$MPA_Group), den_fun1, dt=rov30)
denplot_list1

#Save as list and plot figures
denplot_list2 <-lapply(unique(rov60$MPA_Group), den_fun1, dt=rov60)
denplot_list2

#Save all figures in the list into single pdf
pdf("/Users/shelbyziegler/Desktop/Git Hub/deepwater-MPAs/Invert and Fish Analyses /Figures/Fish-InvertDensityPlots30-60.pdf")
pdf.options(width = 11, height = 8.5)
for (i in 1:length(denplot_list1)){
  print(denplot_list1[[i]])
}
dev.off()

#Save all figures in the list into single pdf
pdf("/Users/shelbyziegler/Desktop/Git Hub/deepwater-MPAs/Invert and Fish Analyses /Figures/Fish-InvertDensityPlots60-130.pdf")
pdf.options(width = 11, height = 8.5)
for (i in 1:length(denplot_list2)){
  print(denplot_list2[[i]])
}
dev.off()

```


Calculate response ratios for both fish and inverts to better understand overall trends within MPAs 

```{r}
# Remove SE and upper and lower CI to calculate RRs 
rovRR<-rov1[, -c(10:12)]

#Spread data by designation (MPA vs Ref)
rovRR<-rovRR%>%
  spread(Designation, MeanDensity)

rovRR[is.na(rovRR)] <- 0

#calcualte log Response Ratio by hand
rovRR$RR<-log(rovRR$MPA/rovRR$Reference)


#Remove infinite values 
rovRR$RR[!is.finite(rovRR$RR)] <- NA
rovRR<-rovRR[complete.cases(rovRR),]

rovRR30<-filter(rovRR, depth=="30-60 m")
rovRR60<-filter(rovRR, depth=="60-130 m")


#Plot data 
RR_fun1<-function(parameter, dt){
  

#plot total fish density through time for MPA and Reference Sites
p<-(ggplot(dt[dt$MPA_Group==parameter,], aes(x=Survey_Year, y=RR, shape=taxa, fill=taxa)) + 
  #geom_histogram(color="black", position="dodge")+
  geom_point(size=5, alpha=0.5)+
    geom_line(aes(color=taxa, linetype=taxa))+
   scale_fill_manual(values=c('#b2182b','#2166ac'))+
  #geom_smooth(method='lm', se=FALSE, color="blue")+
   scale_color_manual(values=c('#b2182b','#2166ac'))+
    scale_shape_manual(values=c(21,22))+
  ylab('Total Fish Density - Response Ratio')+
   xlab("Year")+
  geom_hline(yintercept = 0, linetype="dashed")+
  #geom_errorbar(aes(ymax=upper, ymin=lower),position=position_dodge(0.3), width=0)+
  scale_x_continuous(breaks= c(2005, 2006, 2007, 2008, 2009, 2010, 2011,2012,  2013, 2014, 2015, 2016, 2017, 2018, 2019))+
    facet_grid(Habitat_Type~Type, scales="free")+
  ggtitle(paste0(parameter))+
  theme(plot.title = element_text(size = 16, face = "bold")))+
  theme(panel.border = element_rect(colour = "black", fill=NA, size=1))
    #guides(fill=guide_legend(override.aes=list(shape=21,22)))

return(p)
}

#Save as list and plot figures
rrplot_list <-lapply(unique(rovRR30$MPA_Group), RR_fun1, dt=rovRR30)
rrplot_list

#Save as list and plot figures
rrplot_list1 <-lapply(unique(rovRR60$MPA_Group), RR_fun1, dt=rovRR60)
rrplot_list1


#Save all figures in the list into single pdf
pdf("/Users/shelbyziegler/Desktop/Git Hub/deepwater-MPAs/Invert and Fish Analyses /Figures/Fish-InvertRRPlots30-60.pdf")
pdf.options(width = 11, height = 8.5)
for (i in 1:length(rrplot_list)){
  print(rrplot_list[[i]])
}
dev.off()

#Save all figures in the list into single pdf
pdf("/Users/shelbyziegler/Desktop/Git Hub/deepwater-MPAs/Invert and Fish Analyses /Figures/Fish-InvertRRPlots60-130.pdf")
pdf.options(width = 11, height = 8.5)
for (i in 1:length(rrplot_list1)){
  print(rrplot_list1[[i]])
}
dev.off()
```

Run community composition analyses for both fish and inverts combined

```{r}
library(vegan)

rovspp<-rovall%>%
  group_by(Survey_Year, Region, MPA_Group, Type, Designation, Dive, Line, depth, Habitat_Type, taxa, CommonName)%>%
  filter(CommonName!="YOY")%>%
  summarize(Total.Density=sum(totalden))

rovspp1<-rovspp%>%
   group_by(Survey_Year, Region, MPA_Group, Type, Designation, CommonName)%>%
  summarize(MeanDensity=mean(Total.Density))

rovspp2<-rovspp1%>%
  spread(CommonName, MeanDensity)

rovspp2[is.na(rovspp2)]<-0
#Start with NMDS and diversity indices 
rovsppmeta<-rovspp2[,c(1:5)]
rovsppdata<-rovspp2[,-c(1:5)]

#Add a column of 1s to ensure there are no rows with all 0s (does not change the similarity between rows)
rovsppdata$add<-1


#create bray curtis distribution
abund.dist <- vegdist(rovsppdata, method = "bray")
attach(rovsppmeta) 

#Run PERMANOVA
adonis(abund.dist~MPA_Group*Designation)


```

Calculate the diversity indices

```{r}
#calculating fisher's alpha diversity, shannon diversity and simpson diversity
shan<-diversity(rovsppdata, index="shannon")
simp<-diversity(rovsppdata, index = "simpson")

#calcualte species richness
S <- specnumber(rovsppdata)
#pielou's eveness
J <- shan/log(S)

#add richness and eveness to df
rovsppmeta$richness<-S
rovsppmeta$eveness<-J
rovsppmeta$shannon<-shan
rovsppmeta$simpson<-simp

```

Run NMDS for South Region

```{r}

set.seed(22)
rovS<-rovspp2%>%
  filter(Region=="South")
rovmetaS<-rovS[,c(1:5)]
rovdataS<-rovS[,-c(1:5)]

#try NMDS 
Sprac_NMDS=metaMDS(rovdataS,k=2,trymax=1000)

envfit(Sprac_NMDS, rovdataS)
nmds.envfit <- envfit(Sprac_NMDS, rovmetaS, permutations = 999)
spp.fit <- envfit(Sprac_NMDS, rovdataS, permutations = 999)
#stress is 0.113
#Stress w/out year is 0.161
stressplot(Sprac_NMDS)
 
#group treatment 
plot(Sprac_NMDS)

# you can use ordiellipse but have to identify treatment group - I usually wait until I plot in ggplot because it will do the ellipse around whatever you use the fill or color command

ordiellipse(Sprac_NMDS,groups=Survey_Year,draw="polygon",col="grey90",label=F)
#ordiplot(prac_NMDS,type="n")
orditorp(prac_NMDS, display="species",col="red",air=0.01)

#switch the ordination axes to be more similar to a PCA where axis 1 explains the most variation. 
nms2<-princomp(Sprac_NMDS$points) 
print(nms2)


#Save the plot scores form the nmds into a sheet
Splot.scores<-nms2$scores # plot scores

#rename the columns in your the plot.scores df
colnames(Splot.scores) <- c("NMS1", "NMS2")

#Save the species.score from NMDS
fish.wa <- wascores(Splot.scores,rovdataS)

#make plot.scores sheet into df for plotting
Splot.scores.df<-data.frame(Splot.scores)


spp.scrs <- as.data.frame(scores(spp.fit, display = "vectors")) #save species intrinsic values into dataframe
spp.scrs <- cbind(spp.scrs, Species = rownames(spp.scrs)) #add species names to dataframe
spp.scrs <- cbind(spp.scrs, pval = spp.fit$vectors$pvals) #add pvalues to dataframe so you can select species which are significant
#spp.scrs<- cbind(spp.scrs, abrev = abbreviate(spp.scrs$Species, minlength = 6)) #abbreviate species names
sig.spp.scrs <- subset(spp.scrs, pval<=0.001) #subset data to show species significant at 0.05
sig.spp.scrs<-sig.spp.scrs%>%
  rename(NMS1=NMDS1, NMS2=NMDS2)




#merge the plot scores df with the ROV information df so the nms scores correspond to each row of data 
nmsdfS<-merge(Splot.scores.df,rovmetaS, by="row.names")

#plot NMDS with ggplot - here I am examining the community composition for all MPAs sampled by yera. The stat_ellispe is providing the 95% CI around the data. 
nmsdfS$Year<-factor(nmsdfS$Survey_Year)

#nmsdf$Region<-factor(nmsdf$Region, levels=c("North", "Central", "South"))

#nmsdf$Area<-factor(nmsdf$Area, levels=c("Cape Mendocino","Ten Mile" ,"Stewarts Point","Bodega Head","Ano Nuevo","Point Lobos","Piedras Blancas" ,'Point Buchon',"Carrington Point","Anacapa Island","Swamis","South La Jolla"))


ggplot(nmsdfS, aes(x=NMS1, y=NMS2, shape=Designation, fill=Year))+
  geom_point(size=5, alpha=0.5)+
  scale_shape_manual(values=c(21,22), "Designation")+
  #scale_fill_viridis_d(option='magma', direction=-1)+
   # scale_color_viridis_d(option='magma', direction=-1)+
  scale_fill_manual(values=c("#d73027", "#f46d43", "#fdae61","#fee090", "#e0f3f8","#abd9e9", "#74add1",
  "#4575b4"), "Year")+
  scale_color_manual(values=c("#d73027", "#f46d43", "#fdae61","#fee090", "#e0f3f8","#abd9e9", "#74add1",
  "#4575b4"), "Year")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  stat_ellipse(level=0.95, size=1.1, aes(color=Year, linetype=Designation))+
  facet_wrap(~Survey_Year)+
  ggtitle("Community Composition By Year (South)")+
    theme(plot.title = element_text(size = 16, face = "bold"))+
  theme(panel.border = element_rect(colour = "black", fill=NA, size=1))+
  theme(panel.border = element_rect(colour = "black", fill=NA, size=1))+
   guides(fill=guide_legend(override.aes=list(shape=21)))


(rovsimS<-with(rovmetaS, simper(rovdataS, Survey_Year)))


```


Run NMDS for Central Region

```{r, warning=FALSE}
rovC<-rovspp2%>%
  filter(Region=="Central")
#Start with NMDS and diversity indices 
rovmetaC<-rovC[,c(1:5)]
rovdataC<-rovC[,-c(1:5)]

#Add a column of 1s to ensure there are no rows with all 0s (does not change the similarity between rows)
rovdataC$add<-1


#create bray curtis distribution
abund.dist <- vegdist(rovdataC, method = "bray")
attach(rovmetaC) 

#Run PERMANOVA
adonis(abund.dist~MPA_Group*Designation)

set.seed(22)

#try NMDS 
Cprac_NMDS=metaMDS(rovdataC,k=2,trymax=1000)

envfit(Cprac_NMDS, rovdataC)
nmds.envfit <- envfit(Cprac_NMDS, rovmetaC, permutations = 999)
spp.fit <- envfit(Cprac_NMDS, rovdataC, permutations = 999)
#stress is 0.113
#Stress w/out year is 0.161
stressplot(Cprac_NMDS)
 
#group treatment 
plot(Cprac_NMDS)

# you can use ordiellipse but have to identify treatment group - I usually wait until I plot in ggplot because it will do the ellipse around whatever you use the fill or color command

ordiellipse(Cprac_NMDS,groups=Survey_Year,draw="polygon",col="grey90",label=F)
#ordiplot(prac_NMDS,type="n")
orditorp(Cprac_NMDS, display="species",col="red",air=0.01)

#switch the ordination axes to be more similar to a PCA where axis 1 explains the most variation. 
Cnms2<-princomp(Cprac_NMDS$points) 
print(Cnms2)


#Save the plot scores form the nmds into a sheet
Cplot.scores<-Cnms2$scores # plot scores

#rename the columns in your the plot.scores df
colnames(Cplot.scores) <- c("NMS1", "NMS2")

#Save the species.score from NMDS
fish.wa <- wascores(Cplot.scores,rovdataC)

#make plot.scores sheet into df for plotting
Cplot.scores.df<-data.frame(Cplot.scores)


spp.scrs <- as.data.frame(scores(spp.fit, display = "vectors")) #save species intrinsic values into dataframe
spp.scrs <- cbind(spp.scrs, Species = rownames(spp.scrs)) #add species names to dataframe
spp.scrs <- cbind(spp.scrs, pval = spp.fit$vectors$pvals) #add pvalues to dataframe so you can select species which are significant
#spp.scrs<- cbind(spp.scrs, abrev = abbreviate(spp.scrs$Species, minlength = 6)) #abbreviate species names
sig.spp.scrs <- subset(spp.scrs, pval<=0.001) #subset data to show species significant at 0.05
sig.spp.scrs<-sig.spp.scrs%>%
  rename(NMS1=NMDS1, NMS2=NMDS2)




#merge the plot scores df with the ROV information df so the nms scores correspond to each row of data 
Cnmsdf<-merge(Cplot.scores.df,rovmetaC, by="row.names")

#plot NMDS with ggplot - here I am examining the community composition for all MPAs sampled by yera. The stat_ellispe is providing the 95% CI around the data. 
Cnmsdf$Year<-factor(Cnmsdf$Survey_Year)

#nmsdf$Region<-factor(nmsdf$Region, levels=c("North", "Central", "South"))

#nmsdf$Area<-factor(nmsdf$Area, levels=c("Cape Mendocino","Ten Mile" ,"Stewarts Point","Bodega Head","Ano Nuevo","Point Lobos","Piedras Blancas" ,'Point Buchon',"Carrington Point","Anacapa Island","Swamis","South La Jolla"))


ggplot(Cnmsdf, aes(x=NMS1, y=NMS2, shape=Designation, fill=Year))+
  geom_point(size=5, alpha=0.5)+
  scale_shape_manual(values=c(21,22), "Designation")+
  #scale_fill_viridis_d(option='plasma')+
  #scale_color_viridis_d(option='plasma')+
  scale_fill_manual(values=c("#d73027", "#f46d43", "#fdae61","#fee090", "#abd9e9", "#74add1",
  "#4575b4"), "Year")+
  scale_color_manual(values=c("#d73027", "#f46d43", "#fdae61","#fee090", "#abd9e9", "#74add1",
  "#4575b4"), "Year")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  stat_ellipse(level=0.95, size=1.1, aes(color=Year, linetype=Designation))+
  facet_wrap(~Survey_Year)+
  ggtitle("Community Composition By Year (Central)")+
      theme(plot.title = element_text(size = 16, face = "bold"))+
  theme(panel.border = element_rect(colour = "black", fill=NA, size=1))+
  theme(panel.border = element_rect(colour = "black", fill=NA, size=1))+
   guides(fill=guide_legend(override.aes=list(shape=21)))

(rovsimC<-with(rovmetaC, simper(rovdataC, Survey_Year)))

summary(rovsimC)
```

Run NMDS for North Region

```{r, warning=FALSE}
rovN<-rovspp2%>%
  filter(Region=="North")
#Start with NMDS and diversity indices 
rovmetaN<-rovN[,c(1:5)]
rovdataN<-rovN[,-c(1:5)]

#Add a column of 1s to ensure there are no rows with all 0s (does not change the similarity between rows)
rovdataN$add<-1


#create bray curtis distribution
abund.dist <- vegdist(rovdataN, method = "bray")
attach(rovmetaN) 

#Run PERMANOVA
adonis(abund.dist~MPA_Group*Designation)

set.seed(22)

#try NMDS 
Nprac_NMDS=metaMDS(rovdataN,k=2,trymax=1000)

envfit(Nprac_NMDS, rovdataN)
nmds.envfit <- envfit(Nprac_NMDS, rovmetaN, permutations = 999)
spp.fit <- envfit(Nprac_NMDS, rovdataN, permutations = 999)
stressplot(Nprac_NMDS)
 
#group treatment 
plot(Nprac_NMDS)

# you can use ordiellipse but have to identify treatment group - I usually wait until I plot in ggplot because it will do the ellipse around whatever you use the fill or color command

ordiellipse(Nprac_NMDS,groups=Survey_Year,draw="polygon",col="grey90",label=F)
#ordiplot(prac_NMDS,type="n")
orditorp(Nprac_NMDS, display="species",col="red",air=0.01)

#switch the ordination axes to be more similar to a PCA where axis 1 explains the most variation. 
Nnms2<-princomp(Nprac_NMDS$points) 
print(Nnms2)


#Save the plot scores form the nmds into a sheet
Nplot.scores<-Nnms2$scores # plot scores

#rename the columns in your the plot.scores df
colnames(Nplot.scores) <- c("NMS1", "NMS2")

#Save the species.score from NMDS
fish.wa <- wascores(Nplot.scores,rovdataN)

#make plot.scores sheet into df for plotting
Nplot.scores.df<-data.frame(Nplot.scores)


spp.scrs <- as.data.frame(scores(spp.fit, display = "vectors")) #save species intrinsic values into dataframe
spp.scrs <- cbind(spp.scrs, Species = rownames(spp.scrs)) #add species names to dataframe
spp.scrs <- cbind(spp.scrs, pval = spp.fit$vectors$pvals) #add pvalues to dataframe so you can select species which are significant
#spp.scrs<- cbind(spp.scrs, abrev = abbreviate(spp.scrs$Species, minlength = 6)) #abbreviate species names
sig.spp.scrs <- subset(spp.scrs, pval<=0.001) #subset data to show species significant at 0.05
sig.spp.scrs<-sig.spp.scrs%>%
  rename(NMS1=NMDS1, NMS2=NMDS2)




#merge the plot scores df with the ROV information df so the nms scores correspond to each row of data 
Nnmsdf<-merge(Nplot.scores.df,rovmetaN, by="row.names")

#plot NMDS with ggplot - here I am examining the community composition for all MPAs sampled by yera. The stat_ellispe is providing the 95% CI around the data. 
Nnmsdf$Year<-factor(Nnmsdf$Survey_Year)

#nmsdf$Region<-factor(nmsdf$Region, levels=c("North", "Central", "South"))

#nmsdf$Area<-factor(nmsdf$Area, levels=c("Cape Mendocino","Ten Mile" ,"Stewarts Point","Bodega Head","Ano Nuevo","Point Lobos","Piedras Blancas" ,'Point Buchon',"Carrington Point","Anacapa Island","Swamis","South La Jolla"))


ggplot(Nnmsdf, aes(x=NMS1, y=NMS2, shape=Designation, fill=Year))+
  geom_point(size=5, alpha=0.5)+
  scale_shape_manual(values=c(21,22), "Designation")+
  #scale_fill_viridis_d(option='plasma')+
  #  scale_color_viridis_d(option='plasma')+
   scale_fill_manual(values=c("#d73027",  "#fdae61", "#74add1", "#4575b4"), "Year")+
  scale_color_manual(values=c("#d73027", "#fdae61", "#74add1",  "#4575b4"), "Year")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  stat_ellipse(level=0.95, size=1.1, aes(color=Year, linetype=Designation))+
  facet_wrap(~Survey_Year)+
  ggtitle("Community Composition By Year (North)")+
      theme(plot.title = element_text(size = 16, face = "bold"))+
  theme(panel.border = element_rect(colour = "black", fill=NA, size=1))+
  theme(panel.border = element_rect(colour = "black", fill=NA, size=1))+
   guides(fill=guide_legend(override.aes=list(shape=21)))

(rovsimN<-with(rovmetaN, simper(rovdataN, Survey_Year)))

```
